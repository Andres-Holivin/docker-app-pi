#####################################################################
# --- MCU (Micro-controller Unit) & CONNECTION ---
#####################################################################

[mcu]
# serial: The address of your Mega2560 on the Pi's USB bus.
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0

[printer]
# kinematics: The mechanical arrangement. 'cartesian' = standard X,Y,Z axes.
kinematics: cartesian
# max_velocity: The speed limit for XY moves (mm/s).
max_velocity: 300
# max_accel: How fast the printer reaches top speed (mm/sÂ²). Higher = sharper corners.
max_accel: 1500
# max_z_velocity: Speed limit for vertical Z moves.
max_z_velocity: 5
# max_z_accel: Acceleration limit for vertical Z moves.
max_z_accel: 100

#####################################################################
# --- STEPPER MOTOR SETTINGS ---
#####################################################################

[stepper_x]
# step_pin: The pin that sends the "move" pulse to the motor driver.
step_pin: PF0
# dir_pin: Sets the direction of rotation. Add '!' to reverse it.
dir_pin: PF1
# enable_pin: Power on/off for the motor. '!' means active when signal is low.
enable_pin: !PD7
# microsteps: Steps per full rotation divided by your driver jumpers (usually 16).
microsteps: 16
# rotation_distance: Distance (mm) traveled in one full motor revolution.
rotation_distance: 32
# endstop_pin: The pin for the X limit switch. '^' is the internal pull-up resistor.
endstop_pin: ^!PE5
# homing_speed: How fast the axis travels while looking for the endstop.
homing_speed: 50
# position_endstop: The coordinate (0) when the nozzle hits the switch.
position_endstop: -20   # The nozzle's location when the switch is clicked
position_min: -20       # The lowest coordinate the printer is allowed to go
# position_max: The absolute furthest the X-axis can travel (mm).
position_max: 200       # The highest coordinate (size of your bed)


[stepper_y]
step_pin: PF6
dir_pin: !PF7
enable_pin: !PF2
microsteps: 16
rotation_distance: 32
endstop_pin: ^!PJ1
position_endstop: 0
position_max: 170
homing_speed: 50

[stepper_z]
step_pin: PL3
dir_pin: PL1
enable_pin: !PK0
microsteps: 16
# rotation_distance: 8mm is standard for T8 Lead Screws.
rotation_distance: 8
endstop_pin: ^!PD3
# position_endstop: Higher value = nozzle starts further from the bed.
position_endstop: 0.5
position_max: 200

#####################################################################
# --- EXTRUDER (ON RAMPS E1 SLOT) ---
#####################################################################

[extruder]
# Pins for the second extruder slot (E1) on RAMPS.
step_pin: PC1
dir_pin: !PC3
enable_pin: !PC7
microsteps: 16
# rotation_distance: Distance of filament pushed per turn. Calibrate this for accuracy.
rotation_distance: 33.500
# nozzle_diameter: The exit hole of your brass nozzle.
nozzle_diameter: 0.400
# filament_diameter: Standard size for PLA/ABS/PETG.
filament_diameter: 1.750
# heater_pin: D10 terminal on RAMPS where your heater cartridge is wired.
heater_pin: PB4
# sensor_type: The model of your thermistor sensor.
sensor_type: EPCOS 100K B57560G104F
# sensor_pin: The T0 port on RAMPS (PK5 hardware pin).
sensor_pin: PK5
# PID Tuning: These 3 constants control how stable your temperature is.
control: pid
pid_Kp: 21.203
pid_Ki: 0.827
pid_Kd: 135.962
# min_temp: The floor temperature. Below this, the printer shuts down for safety.
min_temp: 0
# max_temp: The ceiling temperature. Above this, the printer shuts down.
max_temp: 250
max_extrude_cross_section: 2.0

#####################################################################
# --- HEATED BED ---
#####################################################################

[heater_bed]
# heater_pin: D8 terminal on RAMPS for the bed heater.
heater_pin: PH5
sensor_type: EPCOS 100K B57560G104F
# sensor_pin: T1 port on RAMPS (PK6 hardware pin).
sensor_pin: PK6
# watermark: Simple on/off logic for the bed temperature.
control: pid
pid_Kp: 61.343
pid_Ki: 1.043
pid_Kd: 901.743
min_temp: 0
max_temp: 130

#####################################################################
# --- FANS & PERIPHERALS ---
#####################################################################

[fan]
# pin: D9 terminal on RAMPS, used for cooling the printed plastic.
pin: PH6

[display]
# lcd_type: For the classic 4-line blue text display.
lcd_type: hd44780
# Pins required for the Smart Controller adapter on RAMPS.
rs_pin: PH1
e_pin: PH0
d4_pin: PA1
d5_pin: PA3
d6_pin: PA5
d7_pin: PA7
encoder_pins: ^PC6, ^PC4
click_pin: ^!PC2

[output_pin beeper]
# pin: The buzzer on your LCD board.
pin: PC0

#####################################################################
# --- INTERNAL MODULES & MACROS ---
#####################################################################

[virtual_sdcard]
# path: The location on your Pi 4 where G-codes are uploaded.
path: /opt/printer_data/gcodes

[pause_resume]
# Enables the ability to pause a print.

[display_status]
# Allows G-code to send messages and progress to the screen.

[gcode_macro PAUSE]
# Custom logic for what happens when you press 'Pause'.
rename_existing: PAUSE_BASE
gcode:
    PAUSE_BASE
    G91             # Switch to Relative movement
    G1 Z10 F600     # Lift the nozzle 10mm so it doesn't melt the print
    G90             # Switch back to Absolute movement

[gcode_macro RESUME]
# Custom logic for resuming after a pause.
rename_existing: RESUME_BASE
gcode:
    RESUME_BASE

[gcode_macro CANCEL_PRINT]
# Custom logic for stopping a print safely.
rename_existing: CANCEL_PRINT_BASE
gcode:
    TURN_OFF_HEATERS # Safety: stop the nozzle and bed heaters
    CANCEL_PRINT_BASE
    G91
    G1 Z10 F600      # Move up 10mm
    G90
    G28 X Y          # Send the head to the corner out of the way